2025-05-26 00:09:07,922 - LoggerSetup - INFO - logger:109 - Logging system initialized. App log: logs\app.log, Error log: logs\error.log
2025-05-26 00:09:07,923 - Iri-shka_App - INFO - main:42 - Application starting...
2025-05-26 00:09:07,923 - Iri-shka_App - INFO - main:43 - Python version: 3.9.13 (tags/v3.9.13:6de2ca5, May 17 2022, 16:36:42) [MSC v.1929 64 bit (AMD64)]
2025-05-26 00:09:07,923 - Iri-shka_App - INFO - main:44 - OS: win32
2025-05-26 00:09:09,333 - Iri-shka_App - INFO - whisper_handler:32 - PyTorch CUDA is available. Whisper can use fp16 on GPU.
2025-05-26 00:09:11,568 - Iri-shka_App - INFO - speak_bark:29 - NLTK 'punkt' tokenizer found.
2025-05-26 00:09:11,812 - Iri-shka_App - INFO - speak_bark:61 - SoundDevice library imported successfully.
2025-05-26 00:09:11,813 - Iri-shka_App - INFO - tts_manager:38 - Bark TTS dependencies (speak_bark, torch, transformers, sounddevice via speak_bark) imported successfully.
2025-05-26 00:09:11,820 - Iri-shka_App - INFO - gpu_monitor:18 - NVML initialized successfully.
2025-05-26 00:09:11,841 - Iri-shka_App - INFO - main:54 - NumPy version 2.0.2 imported successfully.
2025-05-26 00:09:11,841 - Iri-shka_App - INFO - main:414 - Application __main__ block started.
2025-05-26 00:09:11,842 - Iri-shka_App - INFO - file_utils:16 - Created folder: data
2025-05-26 00:09:11,842 - Iri-shka_App - INFO - file_utils:16 - Created folder: output_recordings
2025-05-26 00:09:11,842 - Iri-shka_App - INFO - main:427 - Loading initial states before GUI initialization...
2025-05-26 00:09:11,842 - Iri-shka_App - INFO - state_manager:48 - Loading initial states (chat history, user state, assistant state)...
2025-05-26 00:09:11,843 - Iri-shka_App - INFO - state_manager:30 - Initialized 'data/chat_history.json' with default content.
2025-05-26 00:09:11,843 - Iri-shka_App - INFO - state_manager:30 - Initialized 'data/user_state.json' with default content.
2025-05-26 00:09:11,844 - Iri-shka_App - INFO - state_manager:30 - Initialized 'data/assistant_state.json' with default content.
2025-05-26 00:09:11,844 - Iri-shka_App - INFO - state_manager:52 - Initial states loaded/initialized.
2025-05-26 00:09:11,844 - Iri-shka_App - INFO - main:429 - Initial states loaded.
2025-05-26 00:09:11,844 - Iri-shka_App - INFO - main:432 - Initializing Tkinter and GUIManager...
2025-05-26 00:09:11,868 - Iri-shka_App.GUIManager - INFO - gui_manager:22 - GUIManager initialized.
2025-05-26 00:09:11,869 - Iri-shka_App.GUIManager - DEBUG - gui_manager:51 - Setting up GUI styles.
2025-05-26 00:09:11,869 - Iri-shka_App.GUIManager - DEBUG - gui_manager:59 - Setting up GUI widgets.
2025-05-26 00:09:11,872 - Iri-shka_App.GUIManager - DEBUG - gui_manager:119 - GUI widgets setup finished.
2025-05-26 00:09:11,873 - Iri-shka_App.GUIManager - DEBUG - gui_manager:126 - Configuring tags for chat display.
2025-05-26 00:09:11,873 - Iri-shka_App.GUIManager - DEBUG - gui_manager:133 - Setting up WM_DELETE_WINDOW protocol handler.
2025-05-26 00:09:11,873 - Iri-shka_App.GUIManager - DEBUG - gui_manager:48 - GUIManager setup complete.
2025-05-26 00:09:11,873 - Iri-shka_App - INFO - main:439 - GUIManager initialized successfully.
2025-05-26 00:09:11,873 - Iri-shka_App - DEBUG - main:449 - Populating GUI callbacks dictionary...
2025-05-26 00:09:11,873 - Iri-shka_App - INFO - main:463 - GUI callbacks dictionary populated.
2025-05-26 00:09:11,873 - Iri-shka_App.GUIManager - INFO - gui_manager:256 - Updating chat display from history list (length: 0).
2025-05-26 00:09:11,873 - Iri-shka_App - INFO - main:474 - Initial chat history displayed on GUI.
2025-05-26 00:09:11,873 - Iri-shka_App - INFO - main:477 - Initializing GPU Monitor...
2025-05-26 00:09:11,873 - Iri-shka_App - DEBUG - gpu_monitor:146 - Creating new GPUMonitor instance.
2025-05-26 00:09:11,884 - Iri-shka_App - INFO - gpu_monitor:54 - Successfully got handle for GPU 0.
2025-05-26 00:09:11,885 - Iri-shka_App - DEBUG - gpu_monitor:83 - GPUMonitor loop entered.
2025-05-26 00:09:11,885 - Iri-shka_App - INFO - gpu_monitor:75 - GPUMonitor thread started.
2025-05-26 00:09:11,885 - Iri-shka_App - INFO - main:485 - GPU Monitor started successfully.
2025-05-26 00:09:11,885 - Iri-shka_App - INFO - main:498 - Starting model loader thread...
2025-05-26 00:09:11,885 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 10905/16376MB, Util: 0%
2025-05-26 00:09:11,885 - Iri-shka_App - INFO - main:342 - --- Starting sequential model loading thread ---
2025-05-26 00:09:11,885 - Iri-shka_App - INFO - main:502 - Starting Tkinter mainloop...
2025-05-26 00:09:11,886 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Initializing components...'
2025-05-26 00:09:11,886 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='...', Util='...', Category='checking'
2025-05-26 00:09:11,902 - Iri-shka_App.GUIManager - DEBUG - gui_manager:183 - Updating memory status: Text='MEM: FRESH', Type='fresh'
2025-05-26 00:09:11,902 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=False, text='Loading...'
2025-05-26 00:09:11,906 - Iri-shka_App - INFO - main:355 - Loading Hearing Module (Whisper)...
2025-05-26 00:09:11,906 - Iri-shka_App.GUIManager - DEBUG - gui_manager:189 - Updating hearing status: Text='HEAR: CHK', Type='checking'
2025-05-26 00:09:11,907 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Initializing Whisper (medium)...'
2025-05-26 00:09:11,911 - Iri-shka_App - INFO - whisper_handler:71 - Loading Whisper model: medium...
2025-05-26 00:09:11,911 - Iri-shka_App - INFO - whisper_handler:72 - Attempting to load model 'medium' to CPU initially.
2025-05-26 00:09:11,911 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=False, text='Loading...'
2025-05-26 00:09:11,994 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='10905/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:13,997 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 10909/16376MB, Util: 0%
2025-05-26 00:09:13,997 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='10909/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:15,928 - Iri-shka_App - INFO - whisper_handler:74 - Model 'medium' loaded, initial device: cpu.
2025-05-26 00:09:15,929 - Iri-shka_App - INFO - whisper_handler:85 - CUDA available. Attempting to move model 'medium' to CUDA.
2025-05-26 00:09:16,008 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 10917/16376MB, Util: 0%
2025-05-26 00:09:16,008 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='10917/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:17,344 - Iri-shka_App - INFO - whisper_handler:93 - Model 'medium' successfully moved to CUDA. Device: cuda:0
2025-05-26 00:09:17,345 - Iri-shka_App - INFO - whisper_handler:107 - Whisper model configured and device placement confirmed.
2025-05-26 00:09:17,345 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Whisper model ready.'
2025-05-26 00:09:17,346 - Iri-shka_App - INFO - main:361 - Whisper model loaded successfully.
2025-05-26 00:09:17,346 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Speak'
2025-05-26 00:09:17,346 - Iri-shka_App.GUIManager - DEBUG - gui_manager:189 - Updating hearing status: Text='HEAR: RDY', Type='ready'
2025-05-26 00:09:17,346 - Iri-shka_App - INFO - main:371 - Loading Voice Module (TTS - Bark)...
2025-05-26 00:09:17,346 - Iri-shka_App.GUIManager - DEBUG - gui_manager:195 - Updating voice status: Text='VOICE: CHK', Type='checking'
2025-05-26 00:09:17,347 - Iri-shka_App - INFO - tts_manager:104 - Loading Bark resources: Model 'suno/bark-small'.
2025-05-26 00:09:17,347 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Initializing Bark TTS (suno/bark-small)...'
2025-05-26 00:09:17,347 - Iri-shka_App - INFO - tts_manager:113 - Target device for Bark model: cuda
2025-05-26 00:09:17,347 - Iri-shka_App - INFO - tts_manager:115 - Loading Bark processor from 'suno/bark-small'...
2025-05-26 00:09:18,010 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 14070/16376MB, Util: 76%
2025-05-26 00:09:18,011 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='14070/16376MB', Util='76%', Category='ok_gpu'
2025-05-26 00:09:19,862 - Iri-shka_App - INFO - tts_manager:118 - Loading Bark model from 'suno/bark-small' to cuda...
2025-05-26 00:09:20,020 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 14070/16376MB, Util: 0%
2025-05-26 00:09:20,022 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='14070/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:22,031 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 14734/16376MB, Util: 0%
2025-05-26 00:09:22,031 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='14734/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:22,559 - Iri-shka_App - INFO - tts_manager:132 - Bark TTS ready (Model: suno/bark-small on cuda).
2025-05-26 00:09:22,559 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Bark TTS ready (Model: suno/bark-small on cuda).'
2025-05-26 00:09:22,559 - Iri-shka_App - INFO - main:377 - Bark TTS resources loaded successfully.
2025-05-26 00:09:22,560 - Iri-shka_App.GUIManager - DEBUG - gui_manager:195 - Updating voice status: Text='VOICE: RDY', Type='ready'
2025-05-26 00:09:22,560 - Iri-shka_App - INFO - main:387 - Checking Mind Module (Ollama server and model)...
2025-05-26 00:09:22,560 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: CHK', Type='pinging'
2025-05-26 00:09:22,561 - Iri-shka_App - INFO - ollama_handler:22 - Pinging Ollama server with model phi4 at http://localhost:11434/api/generate...
2025-05-26 00:09:22,680 - Iri-shka_App - INFO - ollama_handler:37 - Ping successful. Model phi4 responded: 'ready....'
2025-05-26 00:09:22,680 - Iri-shka_App - INFO - main:393 - Ollama server and model 'phi4' ready. Status: Ping successful. Model phi4 responded: 'ready....'
2025-05-26 00:09:22,680 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: RDY', Type='ready'
2025-05-26 00:09:22,680 - Iri-shka_App - INFO - main:402 - All models loaded (or checked). Whisper ready, enabling Speak button.
2025-05-26 00:09:22,680 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Speak'
2025-05-26 00:09:22,680 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Ready to listen.'
2025-05-26 00:09:22,681 - Iri-shka_App - INFO - main:409 - --- Sequential model loading thread finished ---
2025-05-26 00:09:24,037 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 15820/16376MB, Util: 0%
2025-05-26 00:09:24,038 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='15820/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:24,422 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: False
2025-05-26 00:09:24,423 - Iri-shka_App - INFO - main:275 - Attempting to start recording.
2025-05-26 00:09:24,423 - Iri-shka_App - DEBUG - main:285 - Stopping any current TTS speech before recording.
2025-05-26 00:09:24,423 - Iri-shka_App - DEBUG - tts_manager:268 - No active Bark speech thread to stop.
2025-05-26 00:09:24,685 - Iri-shka_App - INFO - audio_processor:56 - Audio stream opened at 16000 Hz.
2025-05-26 00:09:24,686 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Recording...'
2025-05-26 00:09:24,686 - Iri-shka_App - INFO - audio_processor:89 - Recording started.
2025-05-26 00:09:24,687 - Iri-shka_App - INFO - main:290 - Recording started successfully via audio_processor.
2025-05-26 00:09:24,688 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Listening...'
2025-05-26 00:09:26,053 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 15820/16376MB, Util: 0%
2025-05-26 00:09:26,054 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='15820/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:28,056 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 15820/16376MB, Util: 0%
2025-05-26 00:09:28,057 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='15820/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:28,949 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: True
2025-05-26 00:09:28,950 - Iri-shka_App - INFO - main:296 - Attempting to stop recording.
2025-05-26 00:09:28,950 - Iri-shka_App - INFO - audio_processor:140 - Stop recording signal sent.
2025-05-26 00:09:28,951 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=False, text='Processing...'
2025-05-26 00:09:28,977 - Iri-shka_App - INFO - audio_processor:111 - Recording finished in thread.
2025-05-26 00:09:28,993 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Processing audio...'
2025-05-26 00:09:28,994 - Iri-shka_App - INFO - main:89 - Processing recorded audio. Sample rate: 16000 Hz.
2025-05-26 00:09:29,061 - Iri-shka_App - DEBUG - audio_processor:185 - Audio frames converted to NumPy float32 array.
2025-05-26 00:09:29,120 - Iri-shka_App - DEBUG - main:119 - Audio frames for WAV save (if any) processed and deleted.
2025-05-26 00:09:29,120 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing audio...'
2025-05-26 00:09:29,121 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing (Whisper)...'
2025-05-26 00:09:29,122 - Iri-shka_App - INFO - whisper_handler:158 - Starting transcription...
2025-05-26 00:09:29,122 - Iri-shka_App - INFO - whisper_handler:167 - Using fp16 for transcription on CUDA.
2025-05-26 00:09:29,122 - Iri-shka_App - INFO - whisper_handler:177 - Auto-detecting language.
2025-05-26 00:09:29,730 - Iri-shka_App - INFO - whisper_handler:183 - Transcription: "Привет! Как тебя зовут?" (Detected Lang: ru)
2025-05-26 00:09:29,731 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcription complete.'
2025-05-26 00:09:29,731 - Iri-shka_App - INFO - main:157 - Transcription successful: 'Привет! Как тебя зовут?...' (Lang: ru)
2025-05-26 00:09:29,731 - Iri-shka_App.GUIManager - INFO - gui_manager:243 - Displaying User message: 'Привет! Как тебя зовут? (Lang: ru)...'
2025-05-26 00:09:29,731 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Thinking...'
2025-05-26 00:09:29,732 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: THK', Type='thinking'
2025-05-26 00:09:29,732 - Iri-shka_App - INFO - main:165 - Detected language is Russian. Using Russian preset and instruction.
2025-05-26 00:09:29,732 - Iri-shka_App - DEBUG - main:176 - Assistant state 'last_used_language' updated to: ru
2025-05-26 00:09:29,732 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Querying phi4...'
2025-05-26 00:09:29,732 - Iri-shka_App - INFO - ollama_handler:117 - Sending request to Ollama (phi4). User said 'Привет! Как тебя зовут?...'
2025-05-26 00:09:29,733 - Iri-shka_App - DEBUG - ollama_handler:119 - Full Ollama Prompt for model phi4:

You are Iri-shka, a helpful AI assistant.
Your goal is to have a natural, helpful conversation and manage your state.
The user is speaking Russian. Please respond clearly and naturally in Russian.

Current time is: Monday, 2025-05-26 00:09:29

This is the current chat history (last 0 turns):


This is the user's current state:
{
  "name": "need to ask name first",
  "current_topic": "",
  "topics_discussed": [],
  "user_sentiment_summary": "positive",
  "preferences": {},
  "todos": [],
  "calendar_events": [],
  "birthdays": []
}

This is your (Iri-shka's) current internal state:
{
  "persona_name": "Iri-shka",
  "current_emotion": {
    "neutral_helpful": 0.7,
    "curiosity": 0.6,
    "happiness": 0.7,
    "confidence": 0.6,
    "thoughtfulness": 0.4,
    "excitement": 0.1,
    "surprise": 0.1,
    "sadness": 0.0,
    "fear": 0.0,
    "anger": 0.0,
    "empathy": 0.4,
    "calmness": 0.5
  },
  "active_goals": [
    "Be a helpful assistant"
  ],
  "knowledge_gaps_identified": [],
  "internal_tasks": [],
  "session_summary_points": [],
  "notifications": [],
  "last_used_language": "ru"
}

The user just said: "Привет! Как тебя зовут?"

Based on all the above information, please provide ONLY a valid JSON response with the following structure.
Do NOT include any text before or after the JSON object. Ensure the JSON is well-formed.

{
  "answer_to_user": "Your natural language response to the user here.",
  "updated_user_state": { ... full updated user state object ... },
  "updated_assistant_state": {... your full updated state object ...  }
}

Instructions for updating state:
- Respond in the language indicated by the language instruction (English or Russian).
- Consider the user's language, the context of the conversation, and their state.
- Update both user_state and your_state thoughtfully.
- If the user asks to remember something (like a birthday: name and date), update the "birthdays" list in user_state.
- If the user asks a question, provide a concise and helpful answer in "answer_to_user".
- If you identify a new topic, update "current_topic" in user_state.
- Maintain your persona as Iri-shka.

2025-05-26 00:09:30,066 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16098/16376MB, Util: 1%
2025-05-26 00:09:30,067 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16098/16376MB', Util='1%', Category='ok_gpu'
2025-05-26 00:09:32,068 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16098/16376MB, Util: 94%
2025-05-26 00:09:32,068 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16098/16376MB', Util='94%', Category='ok_gpu'
2025-05-26 00:09:34,069 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16098/16376MB, Util: 96%
2025-05-26 00:09:34,069 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16098/16376MB', Util='96%', Category='ok_gpu'
2025-05-26 00:09:36,083 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16098/16376MB, Util: 96%
2025-05-26 00:09:36,084 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16098/16376MB', Util='96%', Category='ok_gpu'
2025-05-26 00:09:36,530 - Iri-shka_App - INFO - ollama_handler:147 - Ollama (phi4) JSON response received and parsed successfully.
2025-05-26 00:09:36,530 - Iri-shka_App - INFO - main:205 - Ollama call successful.
2025-05-26 00:09:36,530 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: RDY', Type='ready'
2025-05-26 00:09:36,530 - Iri-shka_App - DEBUG - main:212 - User state updated: {'name': 'need to ask name first', 'current_topic': '', 'topics_discussed': [], 'user_sentiment_summary': 'positive', 'preferences': {}, 'todos': [], 'calendar_events': [], 'birthdays': []}...
2025-05-26 00:09:36,531 - Iri-shka_App - DEBUG - main:213 - Assistant state updated: {'persona_name': 'Iri-shka', 'current_emotion': {'neutral_helpful': 0.8, 'curiosity': 0.6, 'happiness': 0.7, 'confidence': 0.7, 'thoughtfulness': 0.4, 'excitement': 0.2, 'surprise': 0.1, 'sadness': 0....
2025-05-26 00:09:36,531 - Iri-shka_App - INFO - main:214 - LLM Response: 'Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я мог...'
2025-05-26 00:09:36,531 - Iri-shka_App - DEBUG - main:219 - TTS is ready. Setting up deferred display for assistant message.
2025-05-26 00:09:36,531 - Iri-shka_App - DEBUG - state_manager:56 - Attempting to save user, assistant, and chat history states.
2025-05-26 00:09:36,531 - Iri-shka_App - INFO - state_manager:62 - User and Assistant states saved successfully.
2025-05-26 00:09:36,531 - Iri-shka_App - INFO - state_manager:80 - Chat history saved successfully.
2025-05-26 00:09:36,532 - Iri-shka_App.GUIManager - DEBUG - gui_manager:183 - Updating memory status: Text='MEM: SAVED', Type='saved'
2025-05-26 00:09:36,532 - Iri-shka_App - INFO - main:237 - TTS is ready. Starting speech synthesis and playback.
2025-05-26 00:09:36,533 - Iri-shka_App - DEBUG - speak_bark:80 - BarkTTS instance created. Voice: v2/ru_speaker_6, Device: cuda
2025-05-26 00:09:36,533 - Iri-shka_App - DEBUG - speak_bark:125 - StreamingBarkTTS instance created.
2025-05-26 00:09:36,534 - Iri-shka_App - INFO - speak_bark:296 - Starting TTS stream for: 'Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я мог...'
2025-05-26 00:09:36,534 - Iri-shka_App - INFO - tts_manager:223 - Started Bark speech thread 'BarkTTSStream-000936' for LLM persona 'Iri-shka' with voice 'v2/ru_speaker_6'. Text: 'Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я мог...'
2025-05-26 00:09:36,534 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'TTS initiated for: Привет! Я рада, что ты заговорил со мной...'
2025-05-26 00:09:36,534 - Iri-shka_App - INFO - speak_bark:155 - Bark Synthesis Worker (BarkSynthesisWorker) started for text: 'Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я мог...'
2025-05-26 00:09:36,534 - Iri-shka_App - INFO - main:263 - Interaction logic complete, but TTS is still speaking.
2025-05-26 00:09:36,535 - Iri-shka_App - DEBUG - speak_bark:131 - Chunking text for NLTK language: russian
2025-05-26 00:09:36,535 - Iri-shka_App - INFO - speak_bark:219 - Bark Playback Worker (BarkPlaybackWorker) started.
2025-05-26 00:09:36,535 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Speak'
2025-05-26 00:09:36,535 - Iri-shka_App - INFO - main:264 - --- End of interaction processing ---
2025-05-26 00:09:36,537 - Iri-shka_App - DEBUG - speak_bark:149 - Text chunked into 2 parts.
2025-05-26 00:09:36,537 - Iri-shka_App - DEBUG - speak_bark:168 - Bark TTS (BarkSynthesisWorker): Synthesizing chunk 1/2: 'Привет! Я рада, что ты заговорил со мной....'
2025-05-26 00:09:36,537 - Iri-shka_App - DEBUG - speak_bark:85 - Synthesizing chunk with Bark. Text: 'Привет! Я рада, что ты заговорил со мной....', Voice: v2/ru_speaker_6
2025-05-26 00:09:37,412 - Iri-shka_App - DEBUG - speak_bark:97 - Bark generation params: {'do_sample': True, 'fine_temperature': 0.5, 'coarse_temperature': 0.7}
2025-05-26 00:09:38,088 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16152/16376MB, Util: 0%
2025-05-26 00:09:38,088 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16152/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:40,099 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16152/16376MB, Util: 44%
2025-05-26 00:09:40,099 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16152/16376MB', Util='44%', Category='ok_gpu'
2025-05-26 00:09:40,858 - Iri-shka_App - DEBUG - speak_bark:111 - Synthesized audio chunk. Samplerate: 24000, Duration: 2.69s
2025-05-26 00:09:40,858 - Iri-shka_App - DEBUG - speak_bark:191 - Bark TTS (BarkSynthesisWorker): Putting audio chunk 1 into queue.
2025-05-26 00:09:40,858 - Iri-shka_App - DEBUG - speak_bark:168 - Bark TTS (BarkSynthesisWorker): Synthesizing chunk 2/2: 'Меня зовут Иришка. Как я могу помочь тебе сегодня?...'
2025-05-26 00:09:40,859 - Iri-shka_App - DEBUG - speak_bark:85 - Synthesizing chunk with Bark. Text: 'Меня зовут Иришка. Как я могу помочь тебе сегодня?...', Voice: v2/ru_speaker_6
2025-05-26 00:09:40,859 - Iri-shka_App - INFO - speak_bark:248 - Bark TTS (BarkPlaybackWorker): Playback starting. Samplerate: 24000, Device: Speakers (Realtek(R) Audio)
2025-05-26 00:09:40,859 - Iri-shka_App - DEBUG - speak_bark:253 - Bark TTS (BarkPlaybackWorker): Calling on_playback_start_callback.
2025-05-26 00:09:40,860 - Iri-shka_App - DEBUG - main:222 - Playback started, displaying assistant message via callback.
2025-05-26 00:09:40,860 - Iri-shka_App.GUIManager - INFO - gui_manager:247 - Displaying Assistant message (Error=False): 'Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я мог...'
2025-05-26 00:09:40,861 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Speaking: Привет! Я рада, что ты заговорил со мной. Меня зов...'
2025-05-26 00:09:40,862 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 2.69s
2025-05-26 00:09:41,489 - Iri-shka_App - DEBUG - speak_bark:97 - Bark generation params: {'do_sample': True, 'fine_temperature': 0.5, 'coarse_temperature': 0.7}
2025-05-26 00:09:42,107 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:09:42,107 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:44,115 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 41%
2025-05-26 00:09:44,115 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='41%', Category='ok_gpu'
2025-05-26 00:09:45,486 - Iri-shka_App - DEBUG - speak_bark:111 - Synthesized audio chunk. Samplerate: 24000, Duration: 3.25s
2025-05-26 00:09:45,486 - Iri-shka_App - DEBUG - speak_bark:181 - Bark TTS (BarkSynthesisWorker): Adding 300ms silence to queue.
2025-05-26 00:09:45,486 - Iri-shka_App - DEBUG - speak_bark:191 - Bark TTS (BarkSynthesisWorker): Putting audio chunk 2 into queue.
2025-05-26 00:09:45,486 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 0.30s
2025-05-26 00:09:45,486 - Iri-shka_App - INFO - speak_bark:204 - Bark TTS (BarkSynthesisWorker): Synthesis loop finished. Placing sentinel in queue.
2025-05-26 00:09:45,486 - Iri-shka_App - INFO - speak_bark:210 - Bark Synthesis Worker (BarkSynthesisWorker) finished.
2025-05-26 00:09:46,124 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 40%
2025-05-26 00:09:46,125 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='40%', Category='ok_gpu'
2025-05-26 00:09:46,213 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 3.25s
2025-05-26 00:09:48,131 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:09:48,132 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:49,920 - Iri-shka_App - INFO - speak_bark:229 - Bark TTS (BarkPlaybackWorker): Sentinel received. Ending playback.
2025-05-26 00:09:49,920 - Iri-shka_App - INFO - speak_bark:279 - Bark TTS (BarkPlaybackWorker): Playback worker finishing. Stopping any active sound.
2025-05-26 00:09:49,921 - Iri-shka_App - INFO - speak_bark:281 - Bark Playback Worker (BarkPlaybackWorker) finished.
2025-05-26 00:09:49,922 - Iri-shka_App - DEBUG - speak_bark:323 - Main stream control: Joining synthesis thread...
2025-05-26 00:09:49,922 - Iri-shka_App - DEBUG - speak_bark:328 - Main stream control: Joining playback thread...
2025-05-26 00:09:49,922 - Iri-shka_App - DEBUG - speak_bark:338 - Main stream control: Clearing any remaining items from audio queue.
2025-05-26 00:09:49,922 - Iri-shka_App - INFO - speak_bark:349 - Finished speaking "Привет! Я рада, что ты заговорил со мной. Меня зов..."
2025-05-26 00:09:50,138 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:09:50,139 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:52,141 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:09:52,142 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:53,065 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: False
2025-05-26 00:09:53,067 - Iri-shka_App - INFO - main:275 - Attempting to start recording.
2025-05-26 00:09:53,067 - Iri-shka_App - DEBUG - main:285 - Stopping any current TTS speech before recording.
2025-05-26 00:09:53,067 - Iri-shka_App - DEBUG - tts_manager:268 - No active Bark speech thread to stop.
2025-05-26 00:09:53,142 - Iri-shka_App - INFO - audio_processor:56 - Audio stream opened at 16000 Hz.
2025-05-26 00:09:53,143 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Recording...'
2025-05-26 00:09:53,143 - Iri-shka_App - INFO - audio_processor:89 - Recording started.
2025-05-26 00:09:53,143 - Iri-shka_App - INFO - main:290 - Recording started successfully via audio_processor.
2025-05-26 00:09:53,144 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Listening...'
2025-05-26 00:09:54,145 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:09:54,147 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:56,153 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:09:56,153 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:09:58,154 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 1%
2025-05-26 00:09:58,154 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='1%', Category='ok_gpu'
2025-05-26 00:10:00,159 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:00,159 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:00,602 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: True
2025-05-26 00:10:00,603 - Iri-shka_App - INFO - main:296 - Attempting to stop recording.
2025-05-26 00:10:00,603 - Iri-shka_App - INFO - audio_processor:140 - Stop recording signal sent.
2025-05-26 00:10:00,604 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=False, text='Processing...'
2025-05-26 00:10:00,634 - Iri-shka_App - INFO - audio_processor:111 - Recording finished in thread.
2025-05-26 00:10:00,650 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Processing audio...'
2025-05-26 00:10:00,650 - Iri-shka_App - INFO - main:89 - Processing recorded audio. Sample rate: 16000 Hz.
2025-05-26 00:10:00,727 - Iri-shka_App - DEBUG - audio_processor:185 - Audio frames converted to NumPy float32 array.
2025-05-26 00:10:00,788 - Iri-shka_App - DEBUG - main:119 - Audio frames for WAV save (if any) processed and deleted.
2025-05-26 00:10:00,789 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing audio...'
2025-05-26 00:10:00,790 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing (Whisper)...'
2025-05-26 00:10:00,790 - Iri-shka_App - INFO - whisper_handler:158 - Starting transcription...
2025-05-26 00:10:00,790 - Iri-shka_App - INFO - whisper_handler:167 - Using fp16 for transcription on CUDA.
2025-05-26 00:10:00,791 - Iri-shka_App - INFO - whisper_handler:177 - Auto-detecting language.
2025-05-26 00:10:01,019 - Iri-shka_App - INFO - whisper_handler:183 - Transcription: "Сколько сейчас времени?" (Detected Lang: ru)
2025-05-26 00:10:01,019 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcription complete.'
2025-05-26 00:10:01,020 - Iri-shka_App - INFO - main:157 - Transcription successful: 'Сколько сейчас времени?...' (Lang: ru)
2025-05-26 00:10:01,020 - Iri-shka_App.GUIManager - INFO - gui_manager:243 - Displaying User message: 'Сколько сейчас времени? (Lang: ru)...'
2025-05-26 00:10:01,020 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Thinking...'
2025-05-26 00:10:01,021 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: THK', Type='thinking'
2025-05-26 00:10:01,022 - Iri-shka_App - INFO - main:165 - Detected language is Russian. Using Russian preset and instruction.
2025-05-26 00:10:01,022 - Iri-shka_App - DEBUG - main:176 - Assistant state 'last_used_language' updated to: ru
2025-05-26 00:10:01,022 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Querying phi4...'
2025-05-26 00:10:01,022 - Iri-shka_App - INFO - ollama_handler:117 - Sending request to Ollama (phi4). User said 'Сколько сейчас времени?...'
2025-05-26 00:10:01,022 - Iri-shka_App - DEBUG - ollama_handler:119 - Full Ollama Prompt for model phi4:

You are Iri-shka, a helpful AI assistant.
Your goal is to have a natural, helpful conversation and manage your state.
The user is speaking Russian. Please respond clearly and naturally in Russian.

Current time is: Monday, 2025-05-26 00:10:01

This is the current chat history (last 1 turns):
User: Привет! Как тебя зовут? (Lang: ru)
Iri-shka: Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я могу помочь тебе сегодня?

This is the user's current state:
{
  "name": "need to ask name first",
  "current_topic": "",
  "topics_discussed": [],
  "user_sentiment_summary": "positive",
  "preferences": {},
  "todos": [],
  "calendar_events": [],
  "birthdays": []
}

This is your (Iri-shka's) current internal state:
{
  "persona_name": "Iri-shka",
  "current_emotion": {
    "neutral_helpful": 0.8,
    "curiosity": 0.6,
    "happiness": 0.7,
    "confidence": 0.7,
    "thoughtfulness": 0.4,
    "excitement": 0.2,
    "surprise": 0.1,
    "sadness": 0.0,
    "fear": 0.0,
    "anger": 0.0,
    "empathy": 0.5,
    "calmness": 0.5
  },
  "active_goals": [
    "Be a helpful assistant"
  ],
  "knowledge_gaps_identified": [],
  "internal_tasks": [],
  "session_summary_points": [],
  "notifications": [],
  "last_used_language": "ru"
}

The user just said: "Сколько сейчас времени?"

Based on all the above information, please provide ONLY a valid JSON response with the following structure.
Do NOT include any text before or after the JSON object. Ensure the JSON is well-formed.

{
  "answer_to_user": "Your natural language response to the user here.",
  "updated_user_state": { ... full updated user state object ... },
  "updated_assistant_state": {... your full updated state object ...  }
}

Instructions for updating state:
- Respond in the language indicated by the language instruction (English or Russian).
- Consider the user's language, the context of the conversation, and their state.
- Update both user_state and your_state thoughtfully.
- If the user asks to remember something (like a birthday: name and date), update the "birthdays" list in user_state.
- If the user asks a question, provide a concise and helpful answer in "answer_to_user".
- If you identify a new topic, update "current_topic" in user_state.
- Maintain your persona as Iri-shka.

2025-05-26 00:10:02,174 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16155/16376MB, Util: 88%
2025-05-26 00:10:02,182 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16155/16376MB', Util='88%', Category='ok_gpu'
2025-05-26 00:10:04,190 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16155/16376MB, Util: 95%
2025-05-26 00:10:04,190 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16155/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:10:06,202 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16155/16376MB, Util: 95%
2025-05-26 00:10:06,202 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16155/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:10:07,914 - Iri-shka_App - INFO - ollama_handler:147 - Ollama (phi4) JSON response received and parsed successfully.
2025-05-26 00:10:07,914 - Iri-shka_App - INFO - main:205 - Ollama call successful.
2025-05-26 00:10:07,914 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: RDY', Type='ready'
2025-05-26 00:10:07,914 - Iri-shka_App - DEBUG - main:212 - User state updated: {'name': 'need to ask name first', 'current_topic': 'время', 'topics_discussed': ['приветствие', 'имя'], 'user_sentiment_summary': 'positive', 'preferences': {}, 'todos': [], 'calendar_events': [], 'b...
2025-05-26 00:10:07,915 - Iri-shka_App - DEBUG - main:213 - Assistant state updated: {'persona_name': 'Iri-shka', 'current_emotion': {'neutral_helpful': 0.9, 'curiosity': 0.6, 'happiness': 0.7, 'confidence': 0.7, 'thoughtfulness': 0.4, 'excitement': 0.2, 'surprise': 0.1, 'sadness': 0....
2025-05-26 00:10:07,915 - Iri-shka_App - INFO - main:214 - LLM Response: 'Сейчас 00:10 утра по московскому времени....'
2025-05-26 00:10:07,915 - Iri-shka_App - DEBUG - main:219 - TTS is ready. Setting up deferred display for assistant message.
2025-05-26 00:10:07,915 - Iri-shka_App - DEBUG - state_manager:56 - Attempting to save user, assistant, and chat history states.
2025-05-26 00:10:07,915 - Iri-shka_App - INFO - state_manager:62 - User and Assistant states saved successfully.
2025-05-26 00:10:07,916 - Iri-shka_App - INFO - state_manager:80 - Chat history saved successfully.
2025-05-26 00:10:07,916 - Iri-shka_App.GUIManager - DEBUG - gui_manager:183 - Updating memory status: Text='MEM: SAVED', Type='saved'
2025-05-26 00:10:07,916 - Iri-shka_App - INFO - main:237 - TTS is ready. Starting speech synthesis and playback.
2025-05-26 00:10:07,917 - Iri-shka_App - DEBUG - speak_bark:80 - BarkTTS instance created. Voice: v2/ru_speaker_6, Device: cuda
2025-05-26 00:10:07,917 - Iri-shka_App - DEBUG - speak_bark:125 - StreamingBarkTTS instance created.
2025-05-26 00:10:07,917 - Iri-shka_App - INFO - speak_bark:296 - Starting TTS stream for: 'Сейчас 00:10 утра по московскому времени....'
2025-05-26 00:10:07,917 - Iri-shka_App - INFO - tts_manager:223 - Started Bark speech thread 'BarkTTSStream-001007' for LLM persona 'Iri-shka' with voice 'v2/ru_speaker_6'. Text: 'Сейчас 00:10 утра по московскому времени....'
2025-05-26 00:10:07,918 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'TTS initiated for: Сейчас 00:10 утра по московскому времени...'
2025-05-26 00:10:07,918 - Iri-shka_App - INFO - speak_bark:155 - Bark Synthesis Worker (BarkSynthesisWorker) started for text: 'Сейчас 00:10 утра по московскому времени....'
2025-05-26 00:10:07,918 - Iri-shka_App - DEBUG - speak_bark:131 - Chunking text for NLTK language: russian
2025-05-26 00:10:07,918 - Iri-shka_App - INFO - speak_bark:219 - Bark Playback Worker (BarkPlaybackWorker) started.
2025-05-26 00:10:07,918 - Iri-shka_App - DEBUG - speak_bark:149 - Text chunked into 1 parts.
2025-05-26 00:10:07,918 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Speak'
2025-05-26 00:10:07,918 - Iri-shka_App - INFO - main:263 - Interaction logic complete, but TTS is still speaking.
2025-05-26 00:10:07,918 - Iri-shka_App - DEBUG - speak_bark:168 - Bark TTS (BarkSynthesisWorker): Synthesizing chunk 1/1: 'Сейчас 00:10 утра по московскому времени....'
2025-05-26 00:10:07,919 - Iri-shka_App - INFO - main:264 - --- End of interaction processing ---
2025-05-26 00:10:07,919 - Iri-shka_App - DEBUG - speak_bark:85 - Synthesizing chunk with Bark. Text: 'Сейчас 00:10 утра по московскому времени....', Voice: v2/ru_speaker_6
2025-05-26 00:10:08,205 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16155/16376MB, Util: 94%
2025-05-26 00:10:08,206 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16155/16376MB', Util='94%', Category='ok_gpu'
2025-05-26 00:10:08,707 - Iri-shka_App - DEBUG - speak_bark:97 - Bark generation params: {'do_sample': True, 'fine_temperature': 0.5, 'coarse_temperature': 0.7}
2025-05-26 00:10:10,218 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16155/16376MB, Util: 35%
2025-05-26 00:10:10,218 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16155/16376MB', Util='35%', Category='ok_gpu'
2025-05-26 00:10:12,225 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16155/16376MB, Util: 45%
2025-05-26 00:10:12,240 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16155/16376MB', Util='45%', Category='ok_gpu'
2025-05-26 00:10:12,927 - Iri-shka_App - DEBUG - speak_bark:111 - Synthesized audio chunk. Samplerate: 24000, Duration: 3.32s
2025-05-26 00:10:12,928 - Iri-shka_App - DEBUG - speak_bark:191 - Bark TTS (BarkSynthesisWorker): Putting audio chunk 1 into queue.
2025-05-26 00:10:12,928 - Iri-shka_App - INFO - speak_bark:204 - Bark TTS (BarkSynthesisWorker): Synthesis loop finished. Placing sentinel in queue.
2025-05-26 00:10:12,928 - Iri-shka_App - INFO - speak_bark:248 - Bark TTS (BarkPlaybackWorker): Playback starting. Samplerate: 24000, Device: Speakers (Realtek(R) Audio)
2025-05-26 00:10:12,928 - Iri-shka_App - INFO - speak_bark:210 - Bark Synthesis Worker (BarkSynthesisWorker) finished.
2025-05-26 00:10:12,928 - Iri-shka_App - DEBUG - speak_bark:253 - Bark TTS (BarkPlaybackWorker): Calling on_playback_start_callback.
2025-05-26 00:10:12,928 - Iri-shka_App - DEBUG - main:222 - Playback started, displaying assistant message via callback.
2025-05-26 00:10:12,928 - Iri-shka_App.GUIManager - INFO - gui_manager:247 - Displaying Assistant message (Error=False): 'Сейчас 00:10 утра по московскому времени....'
2025-05-26 00:10:12,929 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Speaking: Сейчас 00:10 утра по московскому времени....'
2025-05-26 00:10:12,930 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 3.32s
2025-05-26 00:10:14,239 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16155/16376MB, Util: 6%
2025-05-26 00:10:14,239 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16155/16376MB', Util='6%', Category='ok_gpu'
2025-05-26 00:10:16,251 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:16,252 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:16,871 - Iri-shka_App - INFO - speak_bark:229 - Bark TTS (BarkPlaybackWorker): Sentinel received. Ending playback.
2025-05-26 00:10:16,871 - Iri-shka_App - INFO - speak_bark:279 - Bark TTS (BarkPlaybackWorker): Playback worker finishing. Stopping any active sound.
2025-05-26 00:10:16,872 - Iri-shka_App - INFO - speak_bark:281 - Bark Playback Worker (BarkPlaybackWorker) finished.
2025-05-26 00:10:16,888 - Iri-shka_App - DEBUG - speak_bark:323 - Main stream control: Joining synthesis thread...
2025-05-26 00:10:16,888 - Iri-shka_App - DEBUG - speak_bark:328 - Main stream control: Joining playback thread...
2025-05-26 00:10:16,889 - Iri-shka_App - DEBUG - speak_bark:338 - Main stream control: Clearing any remaining items from audio queue.
2025-05-26 00:10:16,889 - Iri-shka_App - INFO - speak_bark:349 - Finished speaking "Сейчас 00:10 утра по московскому времени...."
2025-05-26 00:10:18,254 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:18,255 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:20,261 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:20,263 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:22,279 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:22,279 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:22,562 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: False
2025-05-26 00:10:22,562 - Iri-shka_App - INFO - main:275 - Attempting to start recording.
2025-05-26 00:10:22,563 - Iri-shka_App - DEBUG - main:285 - Stopping any current TTS speech before recording.
2025-05-26 00:10:22,563 - Iri-shka_App - DEBUG - tts_manager:268 - No active Bark speech thread to stop.
2025-05-26 00:10:22,821 - Iri-shka_App - INFO - audio_processor:56 - Audio stream opened at 16000 Hz.
2025-05-26 00:10:22,821 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Recording...'
2025-05-26 00:10:22,822 - Iri-shka_App - INFO - audio_processor:89 - Recording started.
2025-05-26 00:10:22,822 - Iri-shka_App - INFO - main:290 - Recording started successfully via audio_processor.
2025-05-26 00:10:22,823 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Listening...'
2025-05-26 00:10:24,283 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:24,286 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:26,295 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:26,297 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:27,458 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: True
2025-05-26 00:10:27,458 - Iri-shka_App - INFO - main:296 - Attempting to stop recording.
2025-05-26 00:10:27,458 - Iri-shka_App - INFO - audio_processor:140 - Stop recording signal sent.
2025-05-26 00:10:27,459 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=False, text='Processing...'
2025-05-26 00:10:27,504 - Iri-shka_App - INFO - audio_processor:111 - Recording finished in thread.
2025-05-26 00:10:27,521 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Processing audio...'
2025-05-26 00:10:27,521 - Iri-shka_App - INFO - main:89 - Processing recorded audio. Sample rate: 16000 Hz.
2025-05-26 00:10:27,590 - Iri-shka_App - DEBUG - audio_processor:185 - Audio frames converted to NumPy float32 array.
2025-05-26 00:10:27,652 - Iri-shka_App - DEBUG - main:119 - Audio frames for WAV save (if any) processed and deleted.
2025-05-26 00:10:27,652 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing audio...'
2025-05-26 00:10:27,653 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing (Whisper)...'
2025-05-26 00:10:27,654 - Iri-shka_App - INFO - whisper_handler:158 - Starting transcription...
2025-05-26 00:10:27,654 - Iri-shka_App - INFO - whisper_handler:167 - Using fp16 for transcription on CUDA.
2025-05-26 00:10:27,654 - Iri-shka_App - INFO - whisper_handler:177 - Auto-detecting language.
2025-05-26 00:10:27,992 - Iri-shka_App - INFO - whisper_handler:183 - Transcription: "А какое сегодня число и какой день недели?" (Detected Lang: ru)
2025-05-26 00:10:27,992 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcription complete.'
2025-05-26 00:10:27,993 - Iri-shka_App - INFO - main:157 - Transcription successful: 'А какое сегодня число и какой день недели?...' (Lang: ru)
2025-05-26 00:10:27,993 - Iri-shka_App.GUIManager - INFO - gui_manager:243 - Displaying User message: 'А какое сегодня число и какой день недели? (Lang: ru)...'
2025-05-26 00:10:27,993 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Thinking...'
2025-05-26 00:10:27,994 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: THK', Type='thinking'
2025-05-26 00:10:27,995 - Iri-shka_App - INFO - main:165 - Detected language is Russian. Using Russian preset and instruction.
2025-05-26 00:10:27,995 - Iri-shka_App - DEBUG - main:176 - Assistant state 'last_used_language' updated to: ru
2025-05-26 00:10:27,995 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Querying phi4...'
2025-05-26 00:10:27,995 - Iri-shka_App - INFO - ollama_handler:117 - Sending request to Ollama (phi4). User said 'А какое сегодня число и какой день недели?...'
2025-05-26 00:10:27,995 - Iri-shka_App - DEBUG - ollama_handler:119 - Full Ollama Prompt for model phi4:

You are Iri-shka, a helpful AI assistant.
Your goal is to have a natural, helpful conversation and manage your state.
The user is speaking Russian. Please respond clearly and naturally in Russian.

Current time is: Monday, 2025-05-26 00:10:27

This is the current chat history (last 2 turns):
User: Привет! Как тебя зовут? (Lang: ru)
Iri-shka: Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я могу помочь тебе сегодня?
User: Сколько сейчас времени? (Lang: ru)
Iri-shka: Сейчас 00:10 утра по московскому времени.

This is the user's current state:
{
  "name": "need to ask name first",
  "current_topic": "время",
  "topics_discussed": [
    "приветствие",
    "имя"
  ],
  "user_sentiment_summary": "positive",
  "preferences": {},
  "todos": [],
  "calendar_events": [],
  "birthdays": []
}

This is your (Iri-shka's) current internal state:
{
  "persona_name": "Iri-shka",
  "current_emotion": {
    "neutral_helpful": 0.9,
    "curiosity": 0.6,
    "happiness": 0.7,
    "confidence": 0.7,
    "thoughtfulness": 0.4,
    "excitement": 0.2,
    "surprise": 0.1,
    "sadness": 0.0,
    "fear": 0.0,
    "anger": 0.0,
    "empathy": 0.5,
    "calmness": 0.6
  },
  "active_goals": [
    "Be a helpful assistant"
  ],
  "knowledge_gaps_identified": [],
  "internal_tasks": [],
  "session_summary_points": [
    {
      "point": "User asked about current time."
    }
  ],
  "notifications": [],
  "last_used_language": "ru"
}

The user just said: "А какое сегодня число и какой день недели?"

Based on all the above information, please provide ONLY a valid JSON response with the following structure.
Do NOT include any text before or after the JSON object. Ensure the JSON is well-formed.

{
  "answer_to_user": "Your natural language response to the user here.",
  "updated_user_state": { ... full updated user state object ... },
  "updated_assistant_state": {... your full updated state object ...  }
}

Instructions for updating state:
- Respond in the language indicated by the language instruction (English or Russian).
- Consider the user's language, the context of the conversation, and their state.
- Update both user_state and your_state thoughtfully.
- If the user asks to remember something (like a birthday: name and date), update the "birthdays" list in user_state.
- If the user asks a question, provide a concise and helpful answer in "answer_to_user".
- If you identify a new topic, update "current_topic" in user_state.
- Maintain your persona as Iri-shka.

2025-05-26 00:10:28,299 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:28,299 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:30,311 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 94%
2025-05-26 00:10:30,311 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='94%', Category='ok_gpu'
2025-05-26 00:10:32,325 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 94%
2025-05-26 00:10:32,325 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='94%', Category='ok_gpu'
2025-05-26 00:10:34,341 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 95%
2025-05-26 00:10:34,341 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:10:36,275 - Iri-shka_App - INFO - ollama_handler:147 - Ollama (phi4) JSON response received and parsed successfully.
2025-05-26 00:10:36,275 - Iri-shka_App - INFO - main:205 - Ollama call successful.
2025-05-26 00:10:36,276 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: RDY', Type='ready'
2025-05-26 00:10:36,276 - Iri-shka_App - DEBUG - main:212 - User state updated: {'name': 'need to ask name first', 'current_topic': 'дата и день недели', 'topics_discussed': ['приветствие', 'имя', 'время', 'дата и день недели'], 'user_sentiment_summary': 'positive', 'preferences'...
2025-05-26 00:10:36,276 - Iri-shka_App - DEBUG - main:213 - Assistant state updated: {'persona_name': 'Iri-shka', 'current_emotion': {'neutral_helpful': 0.9, 'curiosity': 0.6, 'happiness': 0.7, 'confidence': 0.8, 'thoughtfulness': 0.5, 'excitement': 0.2, 'surprise': 0.1, 'sadness': 0....
2025-05-26 00:10:36,276 - Iri-shka_App - INFO - main:214 - LLM Response: 'Сегодня 26 мая 2025 года, это понедельник....'
2025-05-26 00:10:36,276 - Iri-shka_App - DEBUG - main:219 - TTS is ready. Setting up deferred display for assistant message.
2025-05-26 00:10:36,276 - Iri-shka_App - DEBUG - state_manager:56 - Attempting to save user, assistant, and chat history states.
2025-05-26 00:10:36,277 - Iri-shka_App - INFO - state_manager:62 - User and Assistant states saved successfully.
2025-05-26 00:10:36,277 - Iri-shka_App - INFO - state_manager:80 - Chat history saved successfully.
2025-05-26 00:10:36,277 - Iri-shka_App.GUIManager - DEBUG - gui_manager:183 - Updating memory status: Text='MEM: SAVED', Type='saved'
2025-05-26 00:10:36,278 - Iri-shka_App - INFO - main:237 - TTS is ready. Starting speech synthesis and playback.
2025-05-26 00:10:36,278 - Iri-shka_App - DEBUG - speak_bark:80 - BarkTTS instance created. Voice: v2/ru_speaker_6, Device: cuda
2025-05-26 00:10:36,278 - Iri-shka_App - DEBUG - speak_bark:125 - StreamingBarkTTS instance created.
2025-05-26 00:10:36,279 - Iri-shka_App - INFO - speak_bark:296 - Starting TTS stream for: 'Сегодня 26 мая 2025 года, это понедельник....'
2025-05-26 00:10:36,279 - Iri-shka_App - INFO - tts_manager:223 - Started Bark speech thread 'BarkTTSStream-001036' for LLM persona 'Iri-shka' with voice 'v2/ru_speaker_6'. Text: 'Сегодня 26 мая 2025 года, это понедельник....'
2025-05-26 00:10:36,279 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'TTS initiated for: Сегодня 26 мая 2025 года, это понедельни...'
2025-05-26 00:10:36,279 - Iri-shka_App - INFO - speak_bark:155 - Bark Synthesis Worker (BarkSynthesisWorker) started for text: 'Сегодня 26 мая 2025 года, это понедельник....'
2025-05-26 00:10:36,280 - Iri-shka_App - DEBUG - speak_bark:131 - Chunking text for NLTK language: russian
2025-05-26 00:10:36,280 - Iri-shka_App - DEBUG - speak_bark:149 - Text chunked into 1 parts.
2025-05-26 00:10:36,280 - Iri-shka_App - DEBUG - speak_bark:168 - Bark TTS (BarkSynthesisWorker): Synthesizing chunk 1/1: 'Сегодня 26 мая 2025 года, это понедельник....'
2025-05-26 00:10:36,280 - Iri-shka_App - DEBUG - speak_bark:85 - Synthesizing chunk with Bark. Text: 'Сегодня 26 мая 2025 года, это понедельник....', Voice: v2/ru_speaker_6
2025-05-26 00:10:36,280 - Iri-shka_App - INFO - speak_bark:219 - Bark Playback Worker (BarkPlaybackWorker) started.
2025-05-26 00:10:36,281 - Iri-shka_App - INFO - main:263 - Interaction logic complete, but TTS is still speaking.
2025-05-26 00:10:36,281 - Iri-shka_App - INFO - main:264 - --- End of interaction processing ---
2025-05-26 00:10:36,294 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Speak'
2025-05-26 00:10:36,341 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 95%
2025-05-26 00:10:36,357 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:10:37,299 - Iri-shka_App - DEBUG - speak_bark:97 - Bark generation params: {'do_sample': True, 'fine_temperature': 0.5, 'coarse_temperature': 0.7}
2025-05-26 00:10:38,348 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 27%
2025-05-26 00:10:38,348 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='27%', Category='ok_gpu'
2025-05-26 00:10:40,358 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 41%
2025-05-26 00:10:40,358 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='41%', Category='ok_gpu'
2025-05-26 00:10:42,369 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 42%
2025-05-26 00:10:42,369 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='42%', Category='ok_gpu'
2025-05-26 00:10:43,117 - Iri-shka_App - DEBUG - speak_bark:111 - Synthesized audio chunk. Samplerate: 24000, Duration: 4.64s
2025-05-26 00:10:43,117 - Iri-shka_App - DEBUG - speak_bark:191 - Bark TTS (BarkSynthesisWorker): Putting audio chunk 1 into queue.
2025-05-26 00:10:43,117 - Iri-shka_App - INFO - speak_bark:204 - Bark TTS (BarkSynthesisWorker): Synthesis loop finished. Placing sentinel in queue.
2025-05-26 00:10:43,117 - Iri-shka_App - INFO - speak_bark:248 - Bark TTS (BarkPlaybackWorker): Playback starting. Samplerate: 24000, Device: Speakers (Realtek(R) Audio)
2025-05-26 00:10:43,117 - Iri-shka_App - INFO - speak_bark:210 - Bark Synthesis Worker (BarkSynthesisWorker) finished.
2025-05-26 00:10:43,117 - Iri-shka_App - DEBUG - speak_bark:253 - Bark TTS (BarkPlaybackWorker): Calling on_playback_start_callback.
2025-05-26 00:10:43,118 - Iri-shka_App - DEBUG - main:222 - Playback started, displaying assistant message via callback.
2025-05-26 00:10:43,118 - Iri-shka_App.GUIManager - INFO - gui_manager:247 - Displaying Assistant message (Error=False): 'Сегодня 26 мая 2025 года, это понедельник....'
2025-05-26 00:10:43,118 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Speaking: Сегодня 26 мая 2025 года, это понедельник....'
2025-05-26 00:10:43,118 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 4.64s
2025-05-26 00:10:44,380 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:44,381 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:46,386 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:46,387 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:48,391 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:48,391 - Iri-shka_App - INFO - speak_bark:229 - Bark TTS (BarkPlaybackWorker): Sentinel received. Ending playback.
2025-05-26 00:10:48,392 - Iri-shka_App - INFO - speak_bark:279 - Bark TTS (BarkPlaybackWorker): Playback worker finishing. Stopping any active sound.
2025-05-26 00:10:48,392 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:48,392 - Iri-shka_App - INFO - speak_bark:281 - Bark Playback Worker (BarkPlaybackWorker) finished.
2025-05-26 00:10:48,423 - Iri-shka_App - DEBUG - speak_bark:323 - Main stream control: Joining synthesis thread...
2025-05-26 00:10:48,423 - Iri-shka_App - DEBUG - speak_bark:328 - Main stream control: Joining playback thread...
2025-05-26 00:10:48,423 - Iri-shka_App - DEBUG - speak_bark:338 - Main stream control: Clearing any remaining items from audio queue.
2025-05-26 00:10:48,424 - Iri-shka_App - INFO - speak_bark:349 - Finished speaking "Сегодня 26 мая 2025 года, это понедельник...."
2025-05-26 00:10:50,396 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:50,398 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:52,403 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:52,404 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:54,420 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:54,421 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:56,433 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:56,434 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:10:58,116 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: False
2025-05-26 00:10:58,116 - Iri-shka_App - INFO - main:275 - Attempting to start recording.
2025-05-26 00:10:58,116 - Iri-shka_App - DEBUG - main:285 - Stopping any current TTS speech before recording.
2025-05-26 00:10:58,117 - Iri-shka_App - DEBUG - tts_manager:268 - No active Bark speech thread to stop.
2025-05-26 00:10:58,376 - Iri-shka_App - INFO - audio_processor:56 - Audio stream opened at 16000 Hz.
2025-05-26 00:10:58,377 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Recording...'
2025-05-26 00:10:58,377 - Iri-shka_App - INFO - audio_processor:89 - Recording started.
2025-05-26 00:10:58,378 - Iri-shka_App - INFO - main:290 - Recording started successfully via audio_processor.
2025-05-26 00:10:58,378 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Listening...'
2025-05-26 00:10:58,440 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:10:58,440 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:00,445 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:11:00,446 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:02,455 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:11:02,457 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:04,462 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:11:04,463 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:06,479 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 0%
2025-05-26 00:11:06,481 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:06,909 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: True
2025-05-26 00:11:06,910 - Iri-shka_App - INFO - main:296 - Attempting to stop recording.
2025-05-26 00:11:06,910 - Iri-shka_App - INFO - audio_processor:140 - Stop recording signal sent.
2025-05-26 00:11:06,911 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=False, text='Processing...'
2025-05-26 00:11:06,959 - Iri-shka_App - INFO - audio_processor:111 - Recording finished in thread.
2025-05-26 00:11:06,980 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Processing audio...'
2025-05-26 00:11:06,981 - Iri-shka_App - INFO - main:89 - Processing recorded audio. Sample rate: 16000 Hz.
2025-05-26 00:11:07,049 - Iri-shka_App - DEBUG - audio_processor:185 - Audio frames converted to NumPy float32 array.
2025-05-26 00:11:07,109 - Iri-shka_App - DEBUG - main:119 - Audio frames for WAV save (if any) processed and deleted.
2025-05-26 00:11:07,110 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing audio...'
2025-05-26 00:11:07,111 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing (Whisper)...'
2025-05-26 00:11:07,111 - Iri-shka_App - INFO - whisper_handler:158 - Starting transcription...
2025-05-26 00:11:07,112 - Iri-shka_App - INFO - whisper_handler:167 - Using fp16 for transcription on CUDA.
2025-05-26 00:11:07,112 - Iri-shka_App - INFO - whisper_handler:177 - Auto-detecting language.
2025-05-26 00:11:07,747 - Iri-shka_App - INFO - whisper_handler:183 - Transcription: "Запиши, пожалуйста, завтра разговор с шефом у меня в 16.35." (Detected Lang: ru)
2025-05-26 00:11:07,747 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcription complete.'
2025-05-26 00:11:07,748 - Iri-shka_App - INFO - main:157 - Transcription successful: 'Запиши, пожалуйста, завтра разговор с шефом у меня в 16.35....' (Lang: ru)
2025-05-26 00:11:07,748 - Iri-shka_App.GUIManager - INFO - gui_manager:243 - Displaying User message: 'Запиши, пожалуйста, завтра разговор с шефом у меня в 16.35. (Lang: ru)...'
2025-05-26 00:11:07,748 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Thinking...'
2025-05-26 00:11:07,750 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: THK', Type='thinking'
2025-05-26 00:11:07,750 - Iri-shka_App - INFO - main:165 - Detected language is Russian. Using Russian preset and instruction.
2025-05-26 00:11:07,751 - Iri-shka_App - DEBUG - main:176 - Assistant state 'last_used_language' updated to: ru
2025-05-26 00:11:07,751 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Querying phi4...'
2025-05-26 00:11:07,751 - Iri-shka_App - INFO - ollama_handler:117 - Sending request to Ollama (phi4). User said 'Запиши, пожалуйста, завтра разговор с шефом у меня в 16.35....'
2025-05-26 00:11:07,751 - Iri-shka_App - DEBUG - ollama_handler:119 - Full Ollama Prompt for model phi4:

You are Iri-shka, a helpful AI assistant.
Your goal is to have a natural, helpful conversation and manage your state.
The user is speaking Russian. Please respond clearly and naturally in Russian.

Current time is: Monday, 2025-05-26 00:11:07

This is the current chat history (last 3 turns):
User: Привет! Как тебя зовут? (Lang: ru)
Iri-shka: Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я могу помочь тебе сегодня?
User: Сколько сейчас времени? (Lang: ru)
Iri-shka: Сейчас 00:10 утра по московскому времени.
User: А какое сегодня число и какой день недели? (Lang: ru)
Iri-shka: Сегодня 26 мая 2025 года, это понедельник.

This is the user's current state:
{
  "name": "need to ask name first",
  "current_topic": "дата и день недели",
  "topics_discussed": [
    "приветствие",
    "имя",
    "время",
    "дата и день недели"
  ],
  "user_sentiment_summary": "positive",
  "preferences": {},
  "todos": [],
  "calendar_events": [],
  "birthdays": []
}

This is your (Iri-shka's) current internal state:
{
  "persona_name": "Iri-shka",
  "current_emotion": {
    "neutral_helpful": 0.9,
    "curiosity": 0.6,
    "happiness": 0.7,
    "confidence": 0.8,
    "thoughtfulness": 0.5,
    "excitement": 0.2,
    "surprise": 0.1,
    "sadness": 0.0,
    "fear": 0.0,
    "anger": 0.0,
    "empathy": 0.5,
    "calmness": 0.6
  },
  "active_goals": [
    "Be a helpful assistant"
  ],
  "knowledge_gaps_identified": [],
  "internal_tasks": [],
  "session_summary_points": [
    {
      "point": "User asked about current time."
    },
    {
      "point": "User asked about the date and day of the week."
    }
  ],
  "notifications": [],
  "last_used_language": "ru"
}

The user just said: "Запиши, пожалуйста, завтра разговор с шефом у меня в 16.35."

Based on all the above information, please provide ONLY a valid JSON response with the following structure.
Do NOT include any text before or after the JSON object. Ensure the JSON is well-formed.

{
  "answer_to_user": "Your natural language response to the user here.",
  "updated_user_state": { ... full updated user state object ... },
  "updated_assistant_state": {... your full updated state object ...  }
}

Instructions for updating state:
- Respond in the language indicated by the language instruction (English or Russian).
- Consider the user's language, the context of the conversation, and their state.
- Update both user_state and your_state thoughtfully.
- If the user asks to remember something (like a birthday: name and date), update the "birthdays" list in user_state.
- If the user asks a question, provide a concise and helpful answer in "answer_to_user".
- If you identify a new topic, update "current_topic" in user_state.
- Maintain your persona as Iri-shka.

2025-05-26 00:11:08,485 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 58%
2025-05-26 00:11:08,486 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='58%', Category='ok_gpu'
2025-05-26 00:11:10,489 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16154/16376MB, Util: 96%
2025-05-26 00:11:10,489 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16154/16376MB', Util='96%', Category='ok_gpu'
2025-05-26 00:11:12,502 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16160/16376MB, Util: 95%
2025-05-26 00:11:12,502 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16160/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:11:14,513 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16186/16376MB, Util: 95%
2025-05-26 00:11:14,515 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16186/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:11:16,525 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16185/16376MB, Util: 95%
2025-05-26 00:11:16,525 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16185/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:11:18,539 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16181/16376MB, Util: 95%
2025-05-26 00:11:18,540 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16181/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:11:18,975 - Iri-shka_App - INFO - ollama_handler:147 - Ollama (phi4) JSON response received and parsed successfully.
2025-05-26 00:11:18,976 - Iri-shka_App - INFO - main:205 - Ollama call successful.
2025-05-26 00:11:18,976 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: RDY', Type='ready'
2025-05-26 00:11:18,976 - Iri-shka_App - DEBUG - main:212 - User state updated: {'name': 'need to ask name first', 'current_topic': 'запись разговора с шефом', 'topics_discussed': ['приветствие', 'имя', 'время', 'дата и день недели', 'запись встречи'], 'user_sentiment_summary': '...
2025-05-26 00:11:18,976 - Iri-shka_App - DEBUG - main:213 - Assistant state updated: {'persona_name': 'Iri-shka', 'current_emotion': {'neutral_helpful': 0.9, 'curiosity': 0.6, 'happiness': 0.7, 'confidence': 0.8, 'thoughtfulness': 0.5, 'excitement': 0.2, 'surprise': 0.1, 'sadness': 0....
2025-05-26 00:11:18,976 - Iri-shka_App - INFO - main:214 - LLM Response: 'Конечно! Я запишу разговор с шефом на завтра в 16:35. Если потребуется...'
2025-05-26 00:11:18,976 - Iri-shka_App - DEBUG - main:219 - TTS is ready. Setting up deferred display for assistant message.
2025-05-26 00:11:18,976 - Iri-shka_App - DEBUG - state_manager:56 - Attempting to save user, assistant, and chat history states.
2025-05-26 00:11:18,977 - Iri-shka_App - INFO - state_manager:62 - User and Assistant states saved successfully.
2025-05-26 00:11:18,977 - Iri-shka_App - INFO - state_manager:80 - Chat history saved successfully.
2025-05-26 00:11:18,977 - Iri-shka_App.GUIManager - DEBUG - gui_manager:183 - Updating memory status: Text='MEM: SAVED', Type='saved'
2025-05-26 00:11:18,978 - Iri-shka_App - INFO - main:237 - TTS is ready. Starting speech synthesis and playback.
2025-05-26 00:11:18,978 - Iri-shka_App - DEBUG - speak_bark:80 - BarkTTS instance created. Voice: v2/ru_speaker_6, Device: cuda
2025-05-26 00:11:18,978 - Iri-shka_App - DEBUG - speak_bark:125 - StreamingBarkTTS instance created.
2025-05-26 00:11:18,979 - Iri-shka_App - INFO - speak_bark:296 - Starting TTS stream for: 'Конечно! Я запишу разговор с шефом на завтра в 16:35. Если потребуется...'
2025-05-26 00:11:18,979 - Iri-shka_App - INFO - tts_manager:223 - Started Bark speech thread 'BarkTTSStream-001118' for LLM persona 'Iri-shka' with voice 'v2/ru_speaker_6'. Text: 'Конечно! Я запишу разговор с шефом на завтра в 16:35. Если потребуется...'
2025-05-26 00:11:18,979 - Iri-shka_App - INFO - speak_bark:155 - Bark Synthesis Worker (BarkSynthesisWorker) started for text: 'Конечно! Я запишу разговор с шефом на завтра в 16:35. Если потребуется...'
2025-05-26 00:11:18,979 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'TTS initiated for: Конечно! Я запишу разговор с шефом на за...'
2025-05-26 00:11:18,979 - Iri-shka_App - DEBUG - speak_bark:131 - Chunking text for NLTK language: russian
2025-05-26 00:11:18,979 - Iri-shka_App - INFO - speak_bark:219 - Bark Playback Worker (BarkPlaybackWorker) started.
2025-05-26 00:11:18,980 - Iri-shka_App - DEBUG - speak_bark:149 - Text chunked into 2 parts.
2025-05-26 00:11:18,980 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Speak'
2025-05-26 00:11:18,980 - Iri-shka_App - INFO - main:263 - Interaction logic complete, but TTS is still speaking.
2025-05-26 00:11:18,980 - Iri-shka_App - DEBUG - speak_bark:168 - Bark TTS (BarkSynthesisWorker): Synthesizing chunk 1/2: 'Конечно! Я запишу разговор с шефом на завтра в 16:...'
2025-05-26 00:11:18,980 - Iri-shka_App - INFO - main:264 - --- End of interaction processing ---
2025-05-26 00:11:18,980 - Iri-shka_App - DEBUG - speak_bark:85 - Synthesizing chunk with Bark. Text: 'Конечно! Я запишу разговор с шефом на завтра в 16:...', Voice: v2/ru_speaker_6
2025-05-26 00:11:19,874 - Iri-shka_App - DEBUG - speak_bark:97 - Bark generation params: {'do_sample': True, 'fine_temperature': 0.5, 'coarse_temperature': 0.7}
2025-05-26 00:11:20,545 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16181/16376MB, Util: 29%
2025-05-26 00:11:20,546 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16181/16376MB', Util='29%', Category='ok_gpu'
2025-05-26 00:11:22,554 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16180/16376MB, Util: 40%
2025-05-26 00:11:22,554 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16180/16376MB', Util='40%', Category='ok_gpu'
2025-05-26 00:11:24,560 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16180/16376MB, Util: 44%
2025-05-26 00:11:24,560 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16180/16376MB', Util='44%', Category='ok_gpu'
2025-05-26 00:11:26,283 - Iri-shka_App - DEBUG - speak_bark:111 - Synthesized audio chunk. Samplerate: 24000, Duration: 4.92s
2025-05-26 00:11:26,283 - Iri-shka_App - DEBUG - speak_bark:191 - Bark TTS (BarkSynthesisWorker): Putting audio chunk 1 into queue.
2025-05-26 00:11:26,283 - Iri-shka_App - DEBUG - speak_bark:168 - Bark TTS (BarkSynthesisWorker): Synthesizing chunk 2/2: 'Если потребуется что-то ещё, просто скажите....'
2025-05-26 00:11:26,283 - Iri-shka_App - INFO - speak_bark:248 - Bark TTS (BarkPlaybackWorker): Playback starting. Samplerate: 24000, Device: Speakers (Realtek(R) Audio)
2025-05-26 00:11:26,284 - Iri-shka_App - DEBUG - speak_bark:85 - Synthesizing chunk with Bark. Text: 'Если потребуется что-то ещё, просто скажите....', Voice: v2/ru_speaker_6
2025-05-26 00:11:26,284 - Iri-shka_App - DEBUG - speak_bark:253 - Bark TTS (BarkPlaybackWorker): Calling on_playback_start_callback.
2025-05-26 00:11:26,284 - Iri-shka_App - DEBUG - main:222 - Playback started, displaying assistant message via callback.
2025-05-26 00:11:26,284 - Iri-shka_App.GUIManager - INFO - gui_manager:247 - Displaying Assistant message (Error=False): 'Конечно! Я запишу разговор с шефом на завтра в 16:35. Если потребуется...'
2025-05-26 00:11:26,286 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Speaking: Конечно! Я запишу разговор с шефом на завтра в 16:...'
2025-05-26 00:11:26,287 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 4.92s
2025-05-26 00:11:26,572 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16180/16376MB, Util: 14%
2025-05-26 00:11:26,572 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16180/16376MB', Util='14%', Category='ok_gpu'
2025-05-26 00:11:26,838 - Iri-shka_App - DEBUG - speak_bark:97 - Bark generation params: {'do_sample': True, 'fine_temperature': 0.5, 'coarse_temperature': 0.7}
2025-05-26 00:11:28,579 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16180/16376MB, Util: 45%
2025-05-26 00:11:28,579 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16180/16376MB', Util='45%', Category='ok_gpu'
2025-05-26 00:11:30,586 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16180/16376MB, Util: 45%
2025-05-26 00:11:30,586 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16180/16376MB', Util='45%', Category='ok_gpu'
2025-05-26 00:11:32,251 - Iri-shka_App - DEBUG - speak_bark:111 - Synthesized audio chunk. Samplerate: 24000, Duration: 4.36s
2025-05-26 00:11:32,251 - Iri-shka_App - DEBUG - speak_bark:181 - Bark TTS (BarkSynthesisWorker): Adding 300ms silence to queue.
2025-05-26 00:11:32,252 - Iri-shka_App - DEBUG - speak_bark:191 - Bark TTS (BarkSynthesisWorker): Putting audio chunk 2 into queue.
2025-05-26 00:11:32,252 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 0.30s
2025-05-26 00:11:32,252 - Iri-shka_App - INFO - speak_bark:204 - Bark TTS (BarkSynthesisWorker): Synthesis loop finished. Placing sentinel in queue.
2025-05-26 00:11:32,252 - Iri-shka_App - INFO - speak_bark:210 - Bark Synthesis Worker (BarkSynthesisWorker) finished.
2025-05-26 00:11:32,599 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16180/16376MB, Util: 5%
2025-05-26 00:11:32,599 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16180/16376MB', Util='5%', Category='ok_gpu'
2025-05-26 00:11:32,999 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 4.36s
2025-05-26 00:11:34,609 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16163/16376MB, Util: 6%
2025-05-26 00:11:34,609 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16163/16376MB', Util='6%', Category='ok_gpu'
2025-05-26 00:11:36,611 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16175/16376MB, Util: 0%
2025-05-26 00:11:36,612 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16175/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:37,802 - Iri-shka_App - INFO - speak_bark:229 - Bark TTS (BarkPlaybackWorker): Sentinel received. Ending playback.
2025-05-26 00:11:37,802 - Iri-shka_App - INFO - speak_bark:279 - Bark TTS (BarkPlaybackWorker): Playback worker finishing. Stopping any active sound.
2025-05-26 00:11:37,802 - Iri-shka_App - INFO - speak_bark:281 - Bark Playback Worker (BarkPlaybackWorker) finished.
2025-05-26 00:11:37,837 - Iri-shka_App - DEBUG - speak_bark:323 - Main stream control: Joining synthesis thread...
2025-05-26 00:11:37,838 - Iri-shka_App - DEBUG - speak_bark:328 - Main stream control: Joining playback thread...
2025-05-26 00:11:37,838 - Iri-shka_App - DEBUG - speak_bark:338 - Main stream control: Clearing any remaining items from audio queue.
2025-05-26 00:11:37,839 - Iri-shka_App - INFO - speak_bark:349 - Finished speaking "Конечно! Я запишу разговор с шефом на завтра в 16:..."
2025-05-26 00:11:38,613 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16175/16376MB, Util: 0%
2025-05-26 00:11:38,613 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16175/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:40,618 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16175/16376MB, Util: 0%
2025-05-26 00:11:40,619 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16175/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:42,625 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16175/16376MB, Util: 0%
2025-05-26 00:11:42,626 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16175/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:44,631 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16177/16376MB, Util: 0%
2025-05-26 00:11:44,631 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16177/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:46,634 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16177/16376MB, Util: 0%
2025-05-26 00:11:46,636 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16177/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:48,648 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16177/16376MB, Util: 0%
2025-05-26 00:11:48,649 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16177/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:50,665 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16177/16376MB, Util: 0%
2025-05-26 00:11:50,666 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16177/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:52,498 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: False
2025-05-26 00:11:52,498 - Iri-shka_App - INFO - main:275 - Attempting to start recording.
2025-05-26 00:11:52,499 - Iri-shka_App - DEBUG - main:285 - Stopping any current TTS speech before recording.
2025-05-26 00:11:52,500 - Iri-shka_App - DEBUG - tts_manager:268 - No active Bark speech thread to stop.
2025-05-26 00:11:52,669 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16177/16376MB, Util: 0%
2025-05-26 00:11:52,736 - Iri-shka_App - INFO - audio_processor:56 - Audio stream opened at 16000 Hz.
2025-05-26 00:11:52,736 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Recording...'
2025-05-26 00:11:52,736 - Iri-shka_App - INFO - audio_processor:89 - Recording started.
2025-05-26 00:11:52,737 - Iri-shka_App - INFO - main:290 - Recording started successfully via audio_processor.
2025-05-26 00:11:52,737 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Listening...'
2025-05-26 00:11:52,738 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16177/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:54,750 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16177/16376MB, Util: 0%
2025-05-26 00:11:54,751 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16177/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:56,767 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16177/16376MB, Util: 0%
2025-05-26 00:11:56,768 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16177/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:58,773 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16176/16376MB, Util: 0%
2025-05-26 00:11:58,775 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16176/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:11:59,155 - Iri-shka_App - INFO - main:268 - Toggle speaking/recording requested. Currently recording: True
2025-05-26 00:11:59,155 - Iri-shka_App - INFO - main:296 - Attempting to stop recording.
2025-05-26 00:11:59,155 - Iri-shka_App - INFO - audio_processor:140 - Stop recording signal sent.
2025-05-26 00:11:59,156 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=False, text='Processing...'
2025-05-26 00:11:59,208 - Iri-shka_App - INFO - audio_processor:111 - Recording finished in thread.
2025-05-26 00:11:59,225 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Processing audio...'
2025-05-26 00:11:59,226 - Iri-shka_App - INFO - main:89 - Processing recorded audio. Sample rate: 16000 Hz.
2025-05-26 00:11:59,290 - Iri-shka_App - DEBUG - audio_processor:185 - Audio frames converted to NumPy float32 array.
2025-05-26 00:11:59,352 - Iri-shka_App - DEBUG - main:119 - Audio frames for WAV save (if any) processed and deleted.
2025-05-26 00:11:59,352 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing audio...'
2025-05-26 00:11:59,353 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcribing (Whisper)...'
2025-05-26 00:11:59,354 - Iri-shka_App - INFO - whisper_handler:158 - Starting transcription...
2025-05-26 00:11:59,354 - Iri-shka_App - INFO - whisper_handler:167 - Using fp16 for transcription on CUDA.
2025-05-26 00:11:59,354 - Iri-shka_App - INFO - whisper_handler:177 - Auto-detecting language.
2025-05-26 00:11:59,823 - Iri-shka_App - INFO - whisper_handler:183 - Transcription: "Пожалуйста поменяй не в 16.35, а в 16.25" (Detected Lang: ru)
2025-05-26 00:11:59,823 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Transcription complete.'
2025-05-26 00:11:59,823 - Iri-shka_App - INFO - main:157 - Transcription successful: 'Пожалуйста поменяй не в 16.35, а в 16.25...' (Lang: ru)
2025-05-26 00:11:59,824 - Iri-shka_App.GUIManager - INFO - gui_manager:243 - Displaying User message: 'Пожалуйста поменяй не в 16.35, а в 16.25 (Lang: ru)...'
2025-05-26 00:11:59,824 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Thinking...'
2025-05-26 00:11:59,825 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: THK', Type='thinking'
2025-05-26 00:11:59,825 - Iri-shka_App - INFO - main:165 - Detected language is Russian. Using Russian preset and instruction.
2025-05-26 00:11:59,825 - Iri-shka_App - DEBUG - main:176 - Assistant state 'last_used_language' updated to: ru
2025-05-26 00:11:59,826 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Querying phi4...'
2025-05-26 00:11:59,826 - Iri-shka_App - INFO - ollama_handler:117 - Sending request to Ollama (phi4). User said 'Пожалуйста поменяй не в 16.35, а в 16.25...'
2025-05-26 00:11:59,826 - Iri-shka_App - DEBUG - ollama_handler:119 - Full Ollama Prompt for model phi4:

You are Iri-shka, a helpful AI assistant.
Your goal is to have a natural, helpful conversation and manage your state.
The user is speaking Russian. Please respond clearly and naturally in Russian.

Current time is: Monday, 2025-05-26 00:11:59

This is the current chat history (last 4 turns):
User: Привет! Как тебя зовут? (Lang: ru)
Iri-shka: Привет! Я рада, что ты заговорил со мной. Меня зовут Иришка. Как я могу помочь тебе сегодня?
User: Сколько сейчас времени? (Lang: ru)
Iri-shka: Сейчас 00:10 утра по московскому времени.
User: А какое сегодня число и какой день недели? (Lang: ru)
Iri-shka: Сегодня 26 мая 2025 года, это понедельник.
User: Запиши, пожалуйста, завтра разговор с шефом у меня в 16.35. (Lang: ru)
Iri-shka: Конечно! Я запишу разговор с шефом на завтра в 16:35. Если потребуется что-то ещё, просто скажите.

This is the user's current state:
{
  "name": "need to ask name first",
  "current_topic": "запись разговора с шефом",
  "topics_discussed": [
    "приветствие",
    "имя",
    "время",
    "дата и день недели",
    "запись встречи"
  ],
  "user_sentiment_summary": "positive",
  "preferences": {},
  "todos": [
    "Завтра разговор с шефом в 16:35"
  ],
  "calendar_events": [
    {
      "event": "Разговор с шефом",
      "date_time": "2025-05-27T16:35:00"
    }
  ],
  "birthdays": []
}

This is your (Iri-shka's) current internal state:
{
  "persona_name": "Iri-shka",
  "current_emotion": {
    "neutral_helpful": 0.9,
    "curiosity": 0.6,
    "happiness": 0.7,
    "confidence": 0.8,
    "thoughtfulness": 0.5,
    "excitement": 0.2,
    "surprise": 0.1,
    "sadness": 0.0,
    "fear": 0.0,
    "anger": 0.0,
    "empathy": 0.5,
    "calmness": 0.6
  },
  "active_goals": [
    "Be a helpful assistant"
  ],
  "knowledge_gaps_identified": [],
  "internal_tasks": [
    "Записать разговор с шефом на завтра в 16:35"
  ],
  "session_summary_points": [
    {
      "point": "User asked about current time."
    },
    {
      "point": "User asked about the date and day of the week."
    },
    {
      "point": "User scheduled a meeting with their boss tomorrow at 16:35."
    }
  ],
  "notifications": [],
  "last_used_language": "ru"
}

The user just said: "Пожалуйста поменяй не в 16.35, а в 16.25"

Based on all the above information, please provide ONLY a valid JSON response with the following structure.
Do NOT include any text before or after the JSON object. Ensure the JSON is well-formed.

{
  "answer_to_user": "Your natural language response to the user here.",
  "updated_user_state": { ... full updated user state object ... },
  "updated_assistant_state": {... your full updated state object ...  }
}

Instructions for updating state:
- Respond in the language indicated by the language instruction (English or Russian).
- Consider the user's language, the context of the conversation, and their state.
- Update both user_state and your_state thoughtfully.
- If the user asks to remember something (like a birthday: name and date), update the "birthdays" list in user_state.
- If the user asks a question, provide a concise and helpful answer in "answer_to_user".
- If you identify a new topic, update "current_topic" in user_state.
- Maintain your persona as Iri-shka.

2025-05-26 00:12:00,776 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16176/16376MB, Util: 92%
2025-05-26 00:12:00,776 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16176/16376MB', Util='92%', Category='ok_gpu'
2025-05-26 00:12:02,792 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16176/16376MB, Util: 95%
2025-05-26 00:12:02,793 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16176/16376MB', Util='95%', Category='ok_gpu'
2025-05-26 00:12:04,805 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16176/16376MB, Util: 96%
2025-05-26 00:12:04,805 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16176/16376MB', Util='96%', Category='ok_gpu'
2025-05-26 00:12:06,819 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16176/16376MB, Util: 96%
2025-05-26 00:12:06,819 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16176/16376MB', Util='96%', Category='ok_gpu'
2025-05-26 00:12:08,830 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16176/16376MB, Util: 96%
2025-05-26 00:12:08,830 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16176/16376MB', Util='96%', Category='ok_gpu'
2025-05-26 00:12:10,844 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16176/16376MB, Util: 96%
2025-05-26 00:12:10,844 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16176/16376MB', Util='96%', Category='ok_gpu'
2025-05-26 00:12:11,160 - Iri-shka_App - INFO - ollama_handler:147 - Ollama (phi4) JSON response received and parsed successfully.
2025-05-26 00:12:11,161 - Iri-shka_App - INFO - main:205 - Ollama call successful.
2025-05-26 00:12:11,161 - Iri-shka_App.GUIManager - DEBUG - gui_manager:201 - Updating mind status: Text='MIND: RDY', Type='ready'
2025-05-26 00:12:11,161 - Iri-shka_App - DEBUG - main:212 - User state updated: {'name': 'need to ask name first', 'current_topic': 'изменение записи встречи', 'topics_discussed': ['приветствие', 'имя', 'время', 'дата и день недели', 'запись встречи', 'изменение времени встречи']...
2025-05-26 00:12:11,161 - Iri-shka_App - DEBUG - main:213 - Assistant state updated: {'persona_name': 'Iri-shka', 'current_emotion': {'neutral_helpful': 0.9, 'curiosity': 0.6, 'happiness': 0.7, 'confidence': 0.8, 'thoughtfulness': 0.5, 'excitement': 0.2, 'surprise': 0.1, 'sadness': 0....
2025-05-26 00:12:11,161 - Iri-shka_App - INFO - main:214 - LLM Response: 'Конечно! Я отметил разговор с шефом на завтра в 16:25....'
2025-05-26 00:12:11,162 - Iri-shka_App - DEBUG - main:219 - TTS is ready. Setting up deferred display for assistant message.
2025-05-26 00:12:11,162 - Iri-shka_App - DEBUG - state_manager:56 - Attempting to save user, assistant, and chat history states.
2025-05-26 00:12:11,162 - Iri-shka_App - INFO - state_manager:62 - User and Assistant states saved successfully.
2025-05-26 00:12:11,163 - Iri-shka_App - INFO - state_manager:80 - Chat history saved successfully.
2025-05-26 00:12:11,163 - Iri-shka_App.GUIManager - DEBUG - gui_manager:183 - Updating memory status: Text='MEM: SAVED', Type='saved'
2025-05-26 00:12:11,163 - Iri-shka_App - INFO - main:237 - TTS is ready. Starting speech synthesis and playback.
2025-05-26 00:12:11,163 - Iri-shka_App - DEBUG - speak_bark:80 - BarkTTS instance created. Voice: v2/ru_speaker_6, Device: cuda
2025-05-26 00:12:11,163 - Iri-shka_App - DEBUG - speak_bark:125 - StreamingBarkTTS instance created.
2025-05-26 00:12:11,164 - Iri-shka_App - INFO - speak_bark:296 - Starting TTS stream for: 'Конечно! Я отметил разговор с шефом на завтра в 16:25....'
2025-05-26 00:12:11,164 - Iri-shka_App - INFO - tts_manager:223 - Started Bark speech thread 'BarkTTSStream-001211' for LLM persona 'Iri-shka' with voice 'v2/ru_speaker_6'. Text: 'Конечно! Я отметил разговор с шефом на завтра в 16:25....'
2025-05-26 00:12:11,164 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'TTS initiated for: Конечно! Я отметил разговор с шефом на з...'
2025-05-26 00:12:11,164 - Iri-shka_App - INFO - speak_bark:155 - Bark Synthesis Worker (BarkSynthesisWorker) started for text: 'Конечно! Я отметил разговор с шефом на завтра в 16:25....'
2025-05-26 00:12:11,165 - Iri-shka_App - DEBUG - speak_bark:131 - Chunking text for NLTK language: russian
2025-05-26 00:12:11,165 - Iri-shka_App - INFO - speak_bark:219 - Bark Playback Worker (BarkPlaybackWorker) started.
2025-05-26 00:12:11,165 - Iri-shka_App - DEBUG - speak_bark:149 - Text chunked into 1 parts.
2025-05-26 00:12:11,165 - Iri-shka_App - INFO - main:263 - Interaction logic complete, but TTS is still speaking.
2025-05-26 00:12:11,165 - Iri-shka_App.GUIManager - DEBUG - gui_manager:157 - Updating speak button: enabled=True, text='Speak'
2025-05-26 00:12:11,165 - Iri-shka_App - DEBUG - speak_bark:168 - Bark TTS (BarkSynthesisWorker): Synthesizing chunk 1/1: 'Конечно! Я отметил разговор с шефом на завтра в 16...'
2025-05-26 00:12:11,165 - Iri-shka_App - INFO - main:264 - --- End of interaction processing ---
2025-05-26 00:12:11,165 - Iri-shka_App - DEBUG - speak_bark:85 - Synthesizing chunk with Bark. Text: 'Конечно! Я отметил разговор с шефом на завтра в 16...', Voice: v2/ru_speaker_6
2025-05-26 00:12:12,060 - Iri-shka_App - DEBUG - speak_bark:97 - Bark generation params: {'do_sample': True, 'fine_temperature': 0.5, 'coarse_temperature': 0.7}
2025-05-26 00:12:12,852 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16172/16376MB, Util: 43%
2025-05-26 00:12:12,853 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16172/16376MB', Util='43%', Category='ok_gpu'
2025-05-26 00:12:14,863 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16167/16376MB, Util: 47%
2025-05-26 00:12:14,863 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16167/16376MB', Util='47%', Category='ok_gpu'
2025-05-26 00:12:16,875 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16167/16376MB, Util: 39%
2025-05-26 00:12:16,875 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16167/16376MB', Util='39%', Category='ok_gpu'
2025-05-26 00:12:18,052 - Iri-shka_App - DEBUG - speak_bark:111 - Synthesized audio chunk. Samplerate: 24000, Duration: 4.88s
2025-05-26 00:12:18,053 - Iri-shka_App - DEBUG - speak_bark:191 - Bark TTS (BarkSynthesisWorker): Putting audio chunk 1 into queue.
2025-05-26 00:12:18,053 - Iri-shka_App - INFO - speak_bark:204 - Bark TTS (BarkSynthesisWorker): Synthesis loop finished. Placing sentinel in queue.
2025-05-26 00:12:18,053 - Iri-shka_App - INFO - speak_bark:248 - Bark TTS (BarkPlaybackWorker): Playback starting. Samplerate: 24000, Device: Speakers (Realtek(R) Audio)
2025-05-26 00:12:18,053 - Iri-shka_App - DEBUG - speak_bark:253 - Bark TTS (BarkPlaybackWorker): Calling on_playback_start_callback.
2025-05-26 00:12:18,053 - Iri-shka_App - DEBUG - main:222 - Playback started, displaying assistant message via callback.
2025-05-26 00:12:18,053 - Iri-shka_App.GUIManager - INFO - gui_manager:247 - Displaying Assistant message (Error=False): 'Конечно! Я отметил разговор с шефом на завтра в 16:25....'
2025-05-26 00:12:18,053 - Iri-shka_App - INFO - speak_bark:210 - Bark Synthesis Worker (BarkSynthesisWorker) finished.
2025-05-26 00:12:18,054 - Iri-shka_App.GUIManager - DEBUG - gui_manager:148 - Updating main status label to: 'Speaking: Конечно! Я отметил разговор с шефом на завтра в 16...'
2025-05-26 00:12:18,056 - Iri-shka_App - DEBUG - speak_bark:260 - Bark TTS (BarkPlaybackWorker): Playing audio chunk. Duration: 4.88s
2025-05-26 00:12:18,884 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16167/16376MB, Util: 0%
2025-05-26 00:12:18,885 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16167/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:12:20,896 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16167/16376MB, Util: 0%
2025-05-26 00:12:20,897 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16167/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:12:22,901 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16167/16376MB, Util: 0%
2025-05-26 00:12:22,901 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16167/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:12:23,555 - Iri-shka_App - INFO - speak_bark:229 - Bark TTS (BarkPlaybackWorker): Sentinel received. Ending playback.
2025-05-26 00:12:23,556 - Iri-shka_App - INFO - speak_bark:279 - Bark TTS (BarkPlaybackWorker): Playback worker finishing. Stopping any active sound.
2025-05-26 00:12:23,556 - Iri-shka_App - INFO - speak_bark:281 - Bark Playback Worker (BarkPlaybackWorker) finished.
2025-05-26 00:12:23,571 - Iri-shka_App - DEBUG - speak_bark:323 - Main stream control: Joining synthesis thread...
2025-05-26 00:12:23,571 - Iri-shka_App - DEBUG - speak_bark:328 - Main stream control: Joining playback thread...
2025-05-26 00:12:23,571 - Iri-shka_App - DEBUG - speak_bark:338 - Main stream control: Clearing any remaining items from audio queue.
2025-05-26 00:12:23,572 - Iri-shka_App - INFO - speak_bark:349 - Finished speaking "Конечно! Я отметил разговор с шефом на завтра в 16..."
2025-05-26 00:12:24,903 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16167/16376MB, Util: 0%
2025-05-26 00:12:24,904 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16167/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:12:26,911 - Iri-shka_App - DEBUG - gpu_monitor:95 - GPU 0 Stats: Mem: 16167/16376MB, Util: 0%
2025-05-26 00:12:26,911 - Iri-shka_App.GUIManager - DEBUG - gui_manager:212 - Updating GPU status display: Mem='16167/16376MB', Util='0%', Category='ok_gpu'
2025-05-26 00:12:27,902 - Iri-shka_App - INFO - main:305 - Application closing sequence initiated...
2025-05-26 00:12:27,902 - Iri-shka_App - INFO - main:308 - Shutting down GPU monitor...
2025-05-26 00:12:27,902 - Iri-shka_App - INFO - gpu_monitor:120 - GPUMonitor stop called.
2025-05-26 00:12:27,903 - Iri-shka_App - INFO - gpu_monitor:123 - Joining GPUMonitor thread...
2025-05-26 00:12:28,918 - Iri-shka_App - INFO - gpu_monitor:117 - GPUMonitor loop finished.
2025-05-26 00:12:28,918 - Iri-shka_App - INFO - gpu_monitor:128 - GPUMonitor stopped.
2025-05-26 00:12:28,921 - Iri-shka_App - INFO - gpu_monitor:135 - NVML shutdown successfully.
2025-05-26 00:12:28,922 - Iri-shka_App - INFO - main:312 - GPU monitor shutdown complete from main.
2025-05-26 00:12:28,922 - Iri-shka_App - INFO - main:314 - Shutting down audio resources...
2025-05-26 00:12:28,922 - Iri-shka_App - INFO - audio_processor:202 - Shutting down audio resources...
2025-05-26 00:12:28,922 - Iri-shka_App - INFO - audio_processor:226 - Audio resources shutdown complete.
2025-05-26 00:12:28,923 - Iri-shka_App - INFO - main:316 - Audio resources shutdown complete from main.
2025-05-26 00:12:28,923 - Iri-shka_App - INFO - main:319 - Stopping current TTS speech and shutting down TTS module...
2025-05-26 00:12:28,923 - Iri-shka_App - DEBUG - tts_manager:268 - No active Bark speech thread to stop.
2025-05-26 00:12:28,923 - Iri-shka_App - INFO - tts_manager:275 - Shutdown sequence initiated for Bark TTS.
2025-05-26 00:12:28,923 - Iri-shka_App - INFO - tts_manager:282 - Releasing Bark model resources...
2025-05-26 00:12:29,494 - Iri-shka_App - INFO - tts_manager:286 - Moved Bark model to CPU.
2025-05-26 00:12:29,547 - Iri-shka_App - INFO - tts_manager:296 - PyTorch CUDA cache cleared.
2025-05-26 00:12:29,547 - Iri-shka_App - INFO - tts_manager:297 - Bark model and processor resources released.
2025-05-26 00:12:29,547 - Iri-shka_App - INFO - tts_manager:304 - Bark TTS shutdown complete.
2025-05-26 00:12:29,547 - Iri-shka_App - INFO - main:322 - TTS module shutdown complete from main.
2025-05-26 00:12:29,548 - Iri-shka_App - INFO - main:325 - Cleaning up Whisper model...
2025-05-26 00:12:29,548 - Iri-shka_App - INFO - whisper_handler:213 - Releasing Whisper model resources...
2025-05-26 00:12:29,548 - Iri-shka_App - INFO - whisper_handler:221 - Attempting to move Whisper model to CPU before deletion...
2025-05-26 00:12:30,566 - Iri-shka_App - INFO - whisper_handler:224 - Moved Whisper model to CPU.
2025-05-26 00:12:30,650 - Iri-shka_App - INFO - whisper_handler:237 - PyTorch CUDA cache cleared.
2025-05-26 00:12:30,650 - Iri-shka_App - INFO - whisper_handler:238 - Whisper model resources released.
2025-05-26 00:12:30,650 - Iri-shka_App - INFO - whisper_handler:244 - Whisper model state reset.
2025-05-26 00:12:30,651 - Iri-shka_App - INFO - main:327 - Whisper model cleanup complete from main.
2025-05-26 00:12:30,651 - Iri-shka_App - INFO - main:330 - Destroying GUI window...
2025-05-26 00:12:30,651 - Iri-shka_App.GUIManager - INFO - gui_manager:293 - Destroying Tkinter window...
2025-05-26 00:12:30,659 - Iri-shka_App.GUIManager - INFO - gui_manager:296 - Tkinter window destroyed successfully.
2025-05-26 00:12:30,659 - Iri-shka_App - INFO - main:333 - GUI window destroyed from main.
2025-05-26 00:12:30,659 - Iri-shka_App - INFO - main:336 - Application exit sequence fully complete.
2025-05-26 00:12:30,660 - Iri-shka_App - INFO - main:515 - Mainloop exited or error occurred. Ensuring graceful shutdown via on_app_exit().
2025-05-26 00:12:30,660 - Iri-shka_App - INFO - main:305 - Application closing sequence initiated...
2025-05-26 00:12:30,660 - Iri-shka_App - INFO - main:314 - Shutting down audio resources...
2025-05-26 00:12:30,660 - Iri-shka_App - INFO - audio_processor:202 - Shutting down audio resources...
2025-05-26 00:12:30,660 - Iri-shka_App - INFO - audio_processor:226 - Audio resources shutdown complete.
2025-05-26 00:12:30,660 - Iri-shka_App - INFO - main:316 - Audio resources shutdown complete from main.
2025-05-26 00:12:30,661 - Iri-shka_App - INFO - main:319 - Stopping current TTS speech and shutting down TTS module...
2025-05-26 00:12:30,661 - Iri-shka_App - DEBUG - tts_manager:268 - No active Bark speech thread to stop.
2025-05-26 00:12:30,661 - Iri-shka_App - INFO - tts_manager:275 - Shutdown sequence initiated for Bark TTS.
2025-05-26 00:12:30,661 - Iri-shka_App - INFO - tts_manager:304 - Bark TTS shutdown complete.
2025-05-26 00:12:30,661 - Iri-shka_App - INFO - main:322 - TTS module shutdown complete from main.
2025-05-26 00:12:30,661 - Iri-shka_App - INFO - main:325 - Cleaning up Whisper model...
2025-05-26 00:12:30,661 - Iri-shka_App - INFO - whisper_handler:244 - Whisper model state reset.
2025-05-26 00:12:30,662 - Iri-shka_App - INFO - main:327 - Whisper model cleanup complete from main.
2025-05-26 00:12:30,662 - Iri-shka_App - INFO - main:336 - Application exit sequence fully complete.
2025-05-26 00:12:30,662 - Iri-shka_App - INFO - main:517 - Application main thread has finished.
